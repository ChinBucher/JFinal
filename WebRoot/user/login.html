<#include "/common/_layout.html"/>
<@layout>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Login</title>
	<script src="${CTX}/js/jquery.min.js"></script>
    <script type="text/javascript">
    	//document.ready = function(){
    		/*
    		$("#myform").submit(function(event){
    			alert("submit");
    			
    			$.ajax({
    				cache: true,
    				type: "POST",
    				url: "${CTX}/user/dologin",
    				data: $("#myform").serialize(),
    				error: function(XMLHttpRequest, textStatus, errorThrown) {
    					 alert("XMLHttpRequest.status: "+XMLHttpRequest.status);
    					 alert("XMLHttpRequest.readyState: "+XMLHttpRequest.readyState);
    					 alert("textStatus: "+textStatus);
    				 },
    				success: function(data){
    					//alert("success");
    					console.log("data code: "+data.code);
    					if(data.code == 0){
    						$("password").focus();
    						$("#common").html("username or password incorrect");
    					}else if(data.code == 1){
    						$("#common").html("login succeed");
    						window.location = "${CTX}/user";
    						alert("login succeed");
    					}else{
    						$("#common").html("error code:"+data.code+";"+data.message);
    					}
    				}
    			});
    		});
    		
    		}
    	*/
    	//$("#btn").onclick = 
    		function test(){
    		//alert("onclick");
			$.ajax({
				cache: true,
				type: "POST",
				url: "${CTX}/user/dologin",
				data: $("#myform").serialize(),
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					 alert("XMLHttpRequest.status: "+XMLHttpRequest.status);
					 alert("XMLHttpRequest.readyState: "+XMLHttpRequest.readyState);
					 alert("textStatus: "+textStatus);
				 },
				success: function(data){
					//alert("success");
					console.log("data code: "+data.code);
					if(data.code == 0){
						$("password").focus();
						$("#common").html("username or password incorrect");
					}else if(data.code == 1){
						//alert("login succeed");
						$("#common").html("login succeed");
						if(data.name == "admin"){
							window.location = "${CTX}/user";
						}else{
							window.location = "${CTX}/user/detail";
						}
					}else{
						$("#common").html("error code:"+data.code+";"+data.message);
					}
				}
			});
    	}
    	
    	//}
    	
    </script>
</head>
<body>
  <h2>Login</h2>
  <div class="form">
  	<form id="myform">
  		<label>Name:</label>
  		<div>
  			<input id="loginName" name="loginName" type="text">
  		</div>
  		<label>Password</label>
  		<div>
  			<input id="password" name="password" type="password">
  		</div>
  		<div>
  			<!-- 
  			<button type="submit">登陆</button>
  			 -->
  			 <input id="btn" type="button" value="登陆"  onclick="javascript:test();"/>
  		</div>
  	</form>
  	<div id="common"></div>
  </div>


</body>
</html>
</@layout>